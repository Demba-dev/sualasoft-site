<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="blog_posts_page" name="Blog Posts List">
        <t t-call="website.layout">
            <div id="wrap">
                <section class="blog_header py-5 bg-light">
                    <div class="container">
                        <h1 class="mb-3">Blog Sualasoft</h1>
                        <p class="lead text-muted">Actualités, tutoriels et conseils sur Odoo, web et mobile</p>
                    </div>
                </section>

                <section class="blog_content py-5">
                    <div class="container">
                        <div class="row">
                            <!-- Sidebar with filters -->
                            <div class="col-lg-3 mb-4">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body">
                                        <h5 class="card-title mb-4">Catégories</h5>
                                        <div class="list-group list-group-flush">
                                            <a href="/blog" class="list-group-item list-group-item-action" t-att-class="{'active': not selected_category_id}">
                                                Tous les articles
                                            </a>
                                            <t t-foreach="categories" t-as="cat">
                                                <a t-attf-href="/blog?category_id=#{cat.id}" 
                                                   class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                                                   t-att-class="{'active': selected_category_id == cat.id}">
                                                    <span t-esc="cat.name"/>
                                                    <span class="badge bg-secondary rounded-pill" t-esc="len(cat.post_ids.filtered(lambda p: p.active))"/>
                                                </a>
                                            </t>
                                        </div>
                                    </div>
                                </div>

                                <!-- Featured posts -->
                                <t t-if="featured_posts">
                                    <div class="card border-0 shadow-sm mt-4">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Articles en vedette</h5>
                                            <div class="row g-3">
                                                <t t-foreach="featured_posts" t-as="featured_post">
                                                    <div class="col-12">
                                                        <div class="featured-post-card">
                                                            <t t-if="featured_post.featured_image">
                                                                <img t-attf-src="data:image/png;base64,#{featured_post.featured_image}" 
                                                                     class="img-fluid rounded mb-2" 
                                                                     alt="Featured Image"
                                                                     style="height: 150px; object-fit: cover; width: 100%;"/>
                                                            </t>
                                                            <h6 class="mb-2">
                                                                <a t-attf-href="/blog/#{featured_post.slug}" class="text-decoration-none" t-esc="featured_post.name"/>
                                                            </h6>
                                                            <small class="text-muted d-block">
                                                                <t t-esc="featured_post.publication_date.strftime('%d %b %Y')"/>
                                                            </small>
                                                        </div>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>

                            <!-- Posts list -->
                            <div class="col-lg-9">
                                <t t-if="posts">
                                    <div class="row g-4">
                                        <t t-foreach="posts" t-as="blog_post">
                                            <div class="col-md-6 col-lg-6">
                                                <article class="blog-card card h-100 border-0 shadow-sm transition-all" style="transition: transform 0.3s, box-shadow 0.3s;">
                                                    <t t-if="blog_post.featured_image">
                                                        <img t-attf-src="data:image/png;base64,#{blog_post.featured_image}" 
                                                             class="card-img-top" 
                                                             alt="Featured Image"
                                                             style="height: 200px; object-fit: cover;"/>
                                                    </t>
                                                    <t t-else="">
                                                        <div class="bg-light" style="height: 200px; display: flex; align-items: center; justify-content: center;">
                                                            <span class="text-muted">Pas d'image</span>
                                                        </div>
                                                    </t>
                                                    <div class="card-body d-flex flex-column">
                                                        <t t-if="blog_post.featured">
                                                            <span class="badge bg-danger mb-2" style="width: fit-content;">Vedette</span>
                                                        </t>
                                                        <h5 class="card-title mb-2">
                                                            <a t-attf-href="/blog/#{blog_post.slug}" class="text-decoration-none text-dark">
                                                                <t t-esc="blog_post.name"/>
                                                            </a>
                                                        </h5>
                                                        <t t-if="blog_post.summary">
                                                            <p class="card-text text-muted small mb-3" t-esc="blog_post.summary[:150] + '...' if len(blog_post.summary) > 150 else blog_post.summary"/>
                                                        </t>
                                                        <div class="mt-auto">
                                                            <div class="mb-3">
                                                                <t t-foreach="blog_post.category_ids" t-as="cat">
                                                                    <a t-attf-href="/blog?category_id=#{cat.id}" 
                                                                       class="badge bg-light text-dark text-decoration-none me-1 mb-1">
                                                                        <t t-esc="cat.name"/>
                                                                    </a>
                                                                </t>
                                                            </div>
                                                            <div class="d-flex justify-content-between align-items-center text-muted small">
                                                                <span>
                                                                    <i class="fa fa-user me-1"/>
                                                                    <t t-esc="blog_post.author_id.name"/>
                                                                </span>
                                                                <span>
                                                                    <i class="fa fa-calendar me-1"/>
                                                                    <t t-esc="blog_post.publication_date.strftime('%d %b %Y')"/>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </article>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="alert alert-info" role="alert">
                                        <p class="mb-0">Aucun article trouvé pour les critères sélectionnés.</p>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </t>
    </template>

    <template id="blog_post_page" name="Blog Post">
        <t t-call="website.layout">
            <div id="wrap">
                <article class="blog-post-detail py-5">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg-8">
                                <!-- Post header -->
                                <header class="mb-4 pb-4 border-bottom">
                                    <t t-if="post.featured">
                                        <div class="mb-2">
                                            <span class="badge bg-danger">Vedette</span>
                                        </div>
                                    </t>
                                    <h1 class="mb-3" t-esc="post.name"/>
                                    <div class="d-flex flex-wrap gap-3 text-muted small mb-3">
                                        <span class="d-flex align-items-center">
                                            <i class="fa fa-user me-2"/>
                                            <strong>Auteur :</strong>
                                            <span class="ms-1" t-esc="post.author_id.name"/>
                                        </span>
                                        <span class="d-flex align-items-center">
                                            <i class="fa fa-calendar me-2"/>
                                            <strong>Publié :</strong>
                                            <span class="ms-1" t-esc="post.publication_date.strftime('%d %B %Y')"/>
                                        </span>
                                        <t t-if="post.updated_date != post.created_date">
                                            <span class="d-flex align-items-center">
                                                <i class="fa fa-edit me-2"/>
                                                <strong>Mis à jour :</strong>
                                                <span class="ms-1" t-esc="post.updated_date.strftime('%d %B %Y')"/>
                                            </span>
                                        </t>
                                    </div>
                                    <t t-if="post.category_ids">
                                        <div class="mb-2">
                                            <t t-foreach="post.category_ids" t-as="cat">
                                                <a t-attf-href="/blog?category_id=#{cat.id}" 
                                                   class="badge bg-light text-dark text-decoration-none me-2 mb-2">
                                                    <i class="fa fa-folder me-1"/>
                                                    <t t-esc="cat.name"/>
                                                </a>
                                            </t>
                                        </div>
                                    </t>
                                </header>

                                <!-- Featured image -->
                                <t t-if="post.featured_image">
                                    <figure class="figure mb-4">
                                        <img t-attf-src="data:image/png;base64,#{post.featured_image}" 
                                             class="figure-img img-fluid rounded" 
                                             alt="Featured Image"/>
                                    </figure>
                                </t>

                                <!-- Post content -->
                                <div class="post-content mb-5" t-field="post.content"/>

                                <!-- Tags -->
                                <t t-if="post.tags">
                                    <footer class="pt-4 border-top">
                                        <div class="mb-3">
                                            <strong>Tags :</strong>
                                        </div>
                                        <div>
                                            <t t-set="tags" t-value="[t.strip() for t in post.tags.split(',')]"/>
                                            <t t-foreach="tags" t-as="tag">
                                                <a t-attf-href="/blog?tag=#{tag}" 
                                                   class="badge bg-secondary text-decoration-none me-2 mb-2">
                                                    <i class="fa fa-tag me-1"/>
                                                    <t t-esc="tag"/>
                                                </a>
                                            </t>
                                        </div>
                                    </footer>
                                </t>
                            </div>

                            <!-- Sidebar -->
                            <div class="col-lg-4">
                                <!-- Author card -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-body">
                                        <h5 class="card-title mb-3">À propos de l'auteur</h5>
                                        <div class="d-flex align-items-center mb-3">
                                            <t t-if="post.author_id.image_1920">
                                                <img t-attf-src="data:image/png;base64,#{post.author_id.image_1920}" 
                                                     class="rounded-circle me-3" 
                                                     alt="Author Avatar"
                                                     style="width: 60px; height: 60px; object-fit: cover;"/>
                                            </t>
                                            <div>
                                                <h6 class="mb-1" t-esc="post.author_id.name"/>
                                                <t t-if="post.author_id.email">
                                                    <small class="text-muted" t-esc="post.author_id.email"/>
                                                </t>
                                            </div>
                                        </div>
                                        <t t-if="post.author_id.phone">
                                            <small class="d-block mb-2">
                                                <i class="fa fa-phone me-1"/>
                                                <t t-esc="post.author_id.phone"/>
                                            </small>
                                        </t>
                                    </div>
                                </div>

                                <!-- Related posts -->
                                <t t-if="related_posts">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body">
                                            <h5 class="card-title mb-3">Articles similaires</h5>
                                            <div class="related-posts">
                                                <t t-foreach="related_posts" t-as="rel_post">
                                                    <div class="mb-3 pb-3 border-bottom" t-if="rel_post != related_posts[-1]">
                                                        <h6 class="mb-2">
                                                            <a t-attf-href="/blog/#{rel_post.slug}" 
                                                               class="text-decoration-none text-dark">
                                                                <t t-esc="rel_post.name"/>
                                                            </a>
                                                        </h6>
                                                        <small class="text-muted d-block">
                                                            <i class="fa fa-calendar me-1"/>
                                                            <t t-esc="rel_post.publication_date.strftime('%d %b %Y')"/>
                                                        </small>
                                                    </div>
                                                    <div class="mb-0" t-if="rel_post == related_posts[-1]">
                                                        <h6 class="mb-2">
                                                            <a t-attf-href="/blog/#{rel_post.slug}" 
                                                               class="text-decoration-none text-dark">
                                                                <t t-esc="rel_post.name"/>
                                                            </a>
                                                        </h6>
                                                        <small class="text-muted d-block">
                                                            <i class="fa fa-calendar me-1"/>
                                                            <t t-esc="rel_post.publication_date.strftime('%d %b %Y')"/>
                                                        </small>
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </article>

                <!-- Back to blog link -->
                <section class="py-5 bg-light">
                    <div class="container text-center">
                        <a href="/blog" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-left me-2"/>
                            Retour au blog
                        </a>
                    </div>
                </section>
            </div>
        </t>
    </template>
</odoo>
